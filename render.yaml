services:
  - type: web
    name: chompy
    env: python
    plan: free
    packages:
      - ffmpeg
    buildCommand: >-
      mkdir -p .node &&
      curl -fsSL https://nodejs.org/dist/v20.18.1/node-v20.18.1-linux-x64.tar.xz |
      tar -xJ --strip-components=1 -C .node &&
      pip install -r requirements.txt &&
      (pip install "pytubefix>=9.0,<10.0" || true)
    startCommand: PATH=.node/bin:$PATH gunicorn --workers 1 --threads 4 --bind 0.0.0.0:$PORT app:app
    envVars:
      - key: APP_PASSWORD
        sync: false          # Set this in the Render dashboard â€” keep it secret
      - key: SECRET_KEY
        generateValue: true  # Render generates a random value automatically
      - key: MAX_FILE_SIZE_MB
        value: 500
      - key: MAX_DOWNLOADS
        value: 2             # Keep low on Render free (512 MB RAM, shared CPU)
      - key: DOWNLOAD_DIR
        value: /tmp/downloads
